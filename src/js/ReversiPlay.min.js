var LC_MSG_DRAW=0,LC_MSG_ERASE=1,LC_MSG_DRAW_INFO=2,LC_MSG_ERASE_INFO=3,LC_MSG_DRAW_ALL=4,LC_MSG_ERASE_ALL=5,LC_MSG_DRAW_INFO_ALL=6,LC_MSG_ERASE_INFO_ALL=7,LC_MSG_DRAW_END=8,LC_MSG_CUR_COL=9,LC_MSG_CUR_COL_ERASE=10,LC_MSG_CUR_STS=11,LC_MSG_CUR_STS_ERASE=12,LC_MSG_MSG_DLG=13,LC_MSG_DRAW_ALL_RESET=14,ReversiPlay=function(){function t(){this.mCurColor=0,this.mPassEnaB=0,this.mPassEnaW=0,this.mPassEnaL=0,this.mPassEnaR=0,this.mGameEndSts=0,this.mPlayLock=0,this.viewMsgDlgFunc=null,this.drawSingleFunc=null,this.curColMsgFunc=null,this.curStsMsgFunc=null,this.mReversi=new Reversi(DEF_MASU_CNT_MAX_VAL,DEF_MASU_CNT_MAX_VAL),this.mSetting=new ReversiSetting,this.mCpu=new Array,this.mEdge=new Array;for(var t=0;t<DEF_MASU_CNT_MAX_VAL*DEF_MASU_CNT_MAX_VAL;t++)this.mCpu[t]=new ReversiPoint,this.mEdge[t]=new ReversiPoint;this.reset()}return t.prototype.reversiPlay=function(t,s){var e=0,i=0,n=this.mCurColor,S=0;if(1!=this.mPlayLock)if(this.mPlayLock=1,0==this.mReversi.getColorEna(this.mCurColor)?0==this.mReversi.setMasuSts(this.mCurColor,t,s)?(this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW,this.mPassEnaL,this.mPassEnaR),this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_ERASE_INFO_ALL,null),this.sendDrawMsg(t,s),this.drawUpdate(DEF_ASSIST_OFF),0==this.mReversi.getGameEndSts()?(n=this.getNextCol(n),0==this.mReversi.getColorEna(n)?this.mSetting.mMode==DEF_MODE_ONE?i=1:(this.mCurColor=n,this.drawUpdate(this.mSetting.mAssist)):(this.reversiPlayPass(n),S=1)):this.reversiPlayEnd(),e=1):this.viewMsgDlg("エラー","そのマスには置けません。"):0==this.mReversi.getGameEndSts()?(n=this.getNextCol(n),0==this.mReversi.getColorEna(n)?this.mSetting.mMode==DEF_MODE_ONE?(e=1,i=1):this.mCurColor=n:(this.reversiPlayPass(n),S=1)):this.reversiPlayEnd(),1==S&&this.mSetting.mMode==DEF_MODE_ONE&&this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_DRAW_INFO_ALL,null),1==e){var r=0;1==i&&(r=this.mSetting.mPlayCpuInterVal);var _=this;setTimeout(function(t,s){_.reversiPlaySub(t,s),_.mPlayLock=0},r,i,n)}else this.mPlayLock=0},t.prototype.reversiPlaySub=function(t,s){for(var e;;){if(e=this.reversiPlayCpu(s,t),t=0,1==e)if(0==this.mReversi.getGameEndSts())for(;;){if(s=this.getNextCol(s),0==this.mReversi.getColorEna(s)){s!=this.mCurColor&&(t=1);break}0!=this.mReversi.getBetCnt(s)&&this.reversiPlayPass(s)}else this.reversiPlayEnd();if(0==t)break}},t.prototype.reversiPlayEnd=function(){if(0==this.mGameEndSts){this.mGameEndSts=1;var t=this.gameEndAnimExec(),s=this;this.mPlayLock=1,setTimeout(function(){var t,e,i,n,S,r,_;e=s.mReversi.getBetCnt(REVERSI_STS_BLACK),i=s.mReversi.getBetCnt(REVERSI_STS_WHITE),n=s.mReversi.getBetCnt(REVERSI_STS_BLUE),S=s.mReversi.getBetCnt(REVERSI_STS_RED),_=Math.max(e,i,n,S),r=s.mCurColor==REVERSI_STS_BLACK?e:s.mCurColor==REVERSI_STS_WHITE?i:s.mCurColor==REVERSI_STS_BLUE?n:S,t="プレイヤー1 = "+String(e)+" プレイヤー2 = "+String(i)+" プレイヤー3 = "+String(n)+" プレイヤー4 = "+String(S)+(s.mSetting.mMode==DEF_MODE_ONE?_==e&&_==i&&_==n&&_==S?"引き分けです。":_==r?"あなたの勝ちです。":"あなたの負けです。":_==e&&_==i&&_==n&&_==S?"引き分けです。":_==e?"プレイヤー1の勝ちです。":_==i?"プレイヤー2の勝ちです。":_==n?"プレイヤー3の勝ちです。":"プレイヤー4の勝ちです。"),s.viewMsgDlg("ゲーム終了",t),s.mSetting.mEndAnim==DEF_END_ANIM_ON&&(s.execMessage(LC_MSG_CUR_COL,null),s.execMessage(LC_MSG_CUR_STS,null))},t)}},t.prototype.reversiPlayPass=function(t){this.mSetting.mMode==DEF_MODE_ONE||(t==REVERSI_STS_BLACK?this.viewMsgDlg("","プレイヤー1はパスです。"):t==REVERSI_STS_WHITE?this.viewMsgDlg("","プレイヤー2はパスです。"):t==REVERSI_STS_BLUE?this.viewMsgDlg("","プレイヤー3はパスです。"):this.viewMsgDlg("","プレイヤー4はパスです。"))},t.prototype.reversiPlayCpu=function(t,s){for(var e,i,n=0;1==s;){s=0;var S=this.mReversi.getPointCnt(t),r=this.mReversi.getPoint(t,Math.floor(Math.random()*S));if(null!=r){if(e=r.y,i=r.x,this.mSetting.mType!=DEF_TYPE_EASY){var _,E,m,a,o,h,g,R,C,u,M,l,L,v,A,D,T;_=0,E=0,m=0,a=0,o=-1,h=-1,g=-1,R=-1,C=0,u=0,M=0,l=this.mSetting.mMasuCnt*this.mSetting.mMasuCnt,L=0,v=0,A=new Array(3),t==REVERSI_STS_BLACK?(A[0]=REVERSI_STS_WHITE,A[1]=REVERSI_STS_BLUE,A[2]=REVERSI_STS_RED):t==REVERSI_STS_WHITE?(A[0]=REVERSI_STS_BLACK,A[1]=REVERSI_STS_BLUE,A[2]=REVERSI_STS_RED):t==REVERSI_STS_BLUE?(A[0]=REVERSI_STS_BLACK,A[1]=REVERSI_STS_WHITE,A[2]=REVERSI_STS_RED):(A[0]=REVERSI_STS_BLACK,A[1]=REVERSI_STS_WHITE,A[2]=REVERSI_STS_BLUE),D=0;for(p=0;p<3;p++)D+=this.mReversi.getBetCnt(A[p]);T=0,l-(D+this.mReversi.getBetCnt(t))<=16&&(T=1);for(p=0;p<l;p++)this.mCpu[p].x=0,this.mCpu[p].y=0,this.mEdge[p].x=0,this.mEdge[p].y=0;for(p=0;p<this.mSetting.mMasuCnt;p++)for(var I=0;I<this.mSetting.mMasuCnt;I++)0!=this.mReversi.getMasuStsEna(t,p,I)&&(0==this.mReversi.getEdgeSideOne(p,I)?(this.mEdge[M].x=I,this.mEdge[M].y=p,M++):(this.mCpu[C].x=I,this.mCpu[C].y=p,C++),this.mSetting.mType==DEF_TYPE_NOR&&(0==this.mReversi.getEdgeSideZero(p,I)&&(E=1,u=C-1),0==E&&0==this.mReversi.getEdgeSideTwo(p,I)&&(m=1,u=C-1),0==E&&0==m&&0==this.mReversi.getEdgeSideThree(p,I)&&(_=1,u=C-1)),this.mReversi.getMasuStsCnt(t,p,I)==D&&(e=p,i=I,L=1),0==L&&0!=this.mReversi.getPassEna(t,p,I)&&(e=p,i=I,v=1));if(0==L&&0==v){var c,d=-1,P=-1,y=-1,f=-1;if(0!=C){for(p=0;p<C;p++)this.mSetting.mType==DEF_TYPE_HARD&&null!=(c=this.mReversi.getPointAnz(t,this.mCpu[p].y,this.mCpu[p].x))&&(-1==d?(d=c.badPoint,P=c.goodPoint,y=c.pointCnt,f=c.ownPointCnt,h=p,g=p,R=p):(c.badPoint<d&&(d=c.badPoint,h=p),P<c.goodPoint&&(P=c.goodPoint,g=p),c.pointCnt<y?(y=c.pointCnt,f=c.ownPointCnt,R=p):c.pointCnt==y&&f<c.ownPointCnt&&(f=c.ownPointCnt,R=p))),2==this.mReversi.getMasuStsEna(t,this.mCpu[p].y,this.mCpu[p].x)&&(o=p);-1!=h&&(0!=T?-1!=g&&(h=g):-1!=R&&(h=R),o=h),-1==o&&(o=Math.floor(Math.random()*C))}else if(0!=M){for(p=0;p<M;p++)this.mSetting.mType==DEF_TYPE_HARD&&null!=(c=this.mReversi.getPointAnz(t,this.mEdge[p].y,this.mEdge[p].x))&&(-1==d?(d=c.badPoint,P=c.goodPoint,y=c.pointCnt,f=c.ownPointCnt,h=p,g=p,R=p):(c.badPoint<d&&(d=c.badPoint,h=p),P<c.goodPoint&&(P=c.goodPoint,g=p),c.pointCnt<y?(y=c.pointCnt,f=c.ownPointCnt,R=p):c.pointCnt==y&&f<c.ownPointCnt&&(f=c.ownPointCnt,R=p))),2==this.mReversi.getMasuStsEna(t,this.mEdge[p].y,this.mEdge[p].x)&&(o=p);-1!=h&&(0!=T?-1!=g&&(h=g):-1!=R&&(h=R),o=h),-1==o&&(o=Math.floor(Math.random()*M));for(var p=0;p<M;p++)0!=this.mReversi.checkEdge(t,this.mEdge[p].y,this.mEdge[p].x)&&0==_&&0==E&&0==m&&(a=1,u=p)}0==E&&0==m&&0==_&&0==a&&(u=o),0!=C?(e=this.mCpu[u].y,i=this.mCpu[u].x):0!=M&&(e=this.mEdge[u].y,i=this.mEdge[u].x)}}0==this.mReversi.setMasuSts(t,e,i)&&(this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW,this.mPassEnaL,this.mPassEnaR),this.sendDrawMsg(e,i),n=1)}}return 1==n&&(this.drawUpdate(DEF_ASSIST_OFF),this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_DRAW_INFO_ALL,null)),n},t.prototype.drawUpdate=function(t){if(t==DEF_ASSIST_ON)for(i=0;i<this.mSetting.mMasuCnt;i++)for(n=0;n<this.mSetting.mMasuCnt;n++)this.sendDrawInfoMsg(i,n);for(var s=this.mSetting.mPlayDrawInterVal,e=this,i=0;i<this.mSetting.mMasuCnt;i++)for(var n=0;n<this.mSetting.mMasuCnt;n++)this.mReversi.getMasuSts(i,n)!=this.mReversi.getMasuStsOld(i,n)&&(setTimeout(function(t,s){e.sendDrawMsg(t,s)},s,i,n),s+=this.mSetting.mPlayDrawInterVal);this.execMessage(LC_MSG_CUR_COL,null),this.execMessage(LC_MSG_CUR_STS,null)},t.prototype.drawUpdateForcibly=function(t){this.execMessage(LC_MSG_DRAW_ALL,null),t==DEF_ASSIST_ON?this.execMessage(LC_MSG_DRAW_INFO_ALL,null):this.execMessage(LC_MSG_ERASE_INFO_ALL,null),this.execMessage(LC_MSG_CUR_COL,null),this.execMessage(LC_MSG_CUR_STS,null)},t.prototype.reset=function(){if(this.mPassEnaB=0,this.mPassEnaW=0,this.mPassEnaL=0,this.mPassEnaR=0,this.mSetting.mGameSpd==DEF_GAME_SPD_FAST?(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_FAST_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_FAST_VAL2):this.mSetting.mGameSpd==DEF_GAME_SPD_MID?(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_MID_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_MID_VAL2):(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_SLOW_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_SLOW_VAL2),this.mCurColor=this.mSetting.mPlayer,this.mSetting.mMode==DEF_MODE_TWO&&(this.mCurColor=REVERSI_STS_BLACK),this.mReversi.setMasuCnt(this.mSetting.mMasuCnt),this.mReversi.reset(),this.mSetting.mMode==DEF_MODE_ONE&&this.mCurColor!=REVERSI_STS_BLACK){var t,s,e,i;for(t=REVERSI_STS_BLACK;s=this.mReversi.getPointCnt(t),null!=(i=0!=s?this.mReversi.getPoint(t,Math.floor(Math.random()*s)):null)&&(this.mReversi.setMasuSts(t,i.y,i.x),this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW,this.mPassEnaL,this.mPassEnaR)),(e=this.getNextCol(t))!=this.mCurColor;)t=e}this.mPlayLock=1,this.mGameEndSts=0,this.drawUpdateForcibly(this.mSetting.mAssist),this.execMessage(LC_MSG_DRAW_END,null)},t.prototype.gameEndAnimExec=function(){var t,s,e,i,n=0;if(this.mSetting.mEndAnim==DEF_END_ANIM_ON){t=this.mReversi.getBetCnt(REVERSI_STS_BLACK),s=this.mReversi.getBetCnt(REVERSI_STS_WHITE),e=this.mReversi.getBetCnt(REVERSI_STS_BLUE),i=this.mReversi.getBetCnt(REVERSI_STS_RED),this.execMessage(LC_MSG_CUR_COL_ERASE,null),this.execMessage(LC_MSG_CUR_STS_ERASE,null);var S=this;setTimeout(function(t,s){for(R=0;R<S.mSetting.mMasuCnt;R++)for(C=0;C<S.mSetting.mMasuCnt;C++)S.mReversi.setMasuStsForcibly(REVERSI_STS_NONE,R,C);S.execMessage(LC_MSG_ERASE_ALL,null);var n,r,_,E,m,a,o,h;n=0,r=0,_=0,E=0,m=0,a=0,o=0,h=0;for(var g=S.mSetting.mEndDrawInterVal,R=0;R<S.mSetting.mMasuCnt;R++)for(var C=0;C<S.mSetting.mMasuCnt&&(n<t?(n++,setTimeout(function(t,s){S.mReversi.setMasuStsForcibly(REVERSI_STS_BLACK,t,s),S.sendDrawMsg(t,s)},g,R,C)):m=1,r<s?(r++,setTimeout(function(t,s){S.mReversi.setMasuStsForcibly(REVERSI_STS_WHITE,S.mSetting.mMasuCnt-1-t,S.mSetting.mMasuCnt-1-s),S.sendDrawMsg(S.mSetting.mMasuCnt-1-t,S.mSetting.mMasuCnt-1-s)},g,R,C)):a=1,1==m&&(_<e?(_++,setTimeout(function(t,s){S.mReversi.setMasuStsForcibly(REVERSI_STS_BLUE,t,s),S.sendDrawMsg(t,s)},g,R,C)):o=1),1==a&&(E<i?(E++,setTimeout(function(t,s){S.mReversi.setMasuStsForcibly(REVERSI_STS_RED,S.mSetting.mMasuCnt-1-t,S.mSetting.mMasuCnt-1-s),S.sendDrawMsg(S.mSetting.mMasuCnt-1-t,S.mSetting.mMasuCnt-1-s)},g,R,C)):h=1),1!=m||1!=a||1!=o||1!=h);C++)g+=S.mSetting.mEndDrawInterVal},this.mSetting.mEndInterVal,t,s),n=this.mSetting.mEndInterVal+this.mSetting.mEndDrawInterVal*(this.mSetting.mMasuCnt*this.mSetting.mMasuCnt)}return n},t.prototype.sendDrawMsg=function(t,s){var e=new ReversiPoint;e.y=t,e.x=s,this.execMessage(LC_MSG_DRAW,e)},t.prototype.sendDrawInfoMsg=function(t,s){var e=new ReversiPoint;e.y=t,e.x=s,this.execMessage(LC_MSG_DRAW_INFO,e)},t.prototype.setViewMsgDlgFunc=function(t){this.viewMsgDlgFunc=t},t.prototype.viewMsgDlg=function(t,s){null!=this.viewMsgDlgFunc&&this.viewMsgDlgFunc(t,s)},t.prototype.setDrawSingleFunc=function(t){this.drawSingleFunc=t},t.prototype.drawSingle=function(t,s,e,i,n){null!=this.drawSingleFunc&&("0"==n&&(n=""),this.drawSingleFunc(t,s,e,i,n))},t.prototype.setCurColMsgFunc=function(t){this.curColMsgFunc=t},t.prototype.curColMsg=function(t){null!=this.curColMsgFunc&&this.curColMsgFunc(t)},t.prototype.setCurStsMsgFunc=function(t){this.curStsMsgFunc=t},t.prototype.curStsMsg=function(t){null!=this.curStsMsgFunc&&this.curStsMsgFunc(t)},t.prototype.execMessage=function(t,s){var e,i,n;if(t==LC_MSG_DRAW){S=s;e=this.mReversi.getMasuSts(S.y,S.x),i=this.mReversi.getMasuStsEna(this.mCurColor,S.y,S.x),n=this.mReversi.getMasuStsCnt(this.mCurColor,S.y,S.x),this.drawSingle(S.y,S.x,e,i,String(n))}else if(t==LC_MSG_ERASE){S=s;this.drawSingle(S.y,S.x,0,0,String(0))}else if(t==LC_MSG_DRAW_INFO){S=s;e=this.mReversi.getMasuSts(S.y,S.x),i=this.mReversi.getMasuStsEna(this.mCurColor,S.y,S.x),n=this.mReversi.getMasuStsCnt(this.mCurColor,S.y,S.x),this.drawSingle(S.y,S.x,e,i,String(n))}else if(t==LC_MSG_ERASE_INFO){var S=s;e=this.mReversi.getMasuSts(S.y,S.x),this.drawSingle(S.y,S.x,e,0,String(0))}else if(t==LC_MSG_DRAW_ALL)for(r=0;r<this.mSetting.mMasuCnt;r++)for(_=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),i=this.mReversi.getMasuStsEna(this.mCurColor,r,_),n=this.mReversi.getMasuStsCnt(this.mCurColor,r,_),this.drawSingle(r,_,e,i,String(n));else if(t==LC_MSG_ERASE_ALL)for(r=0;r<this.mSetting.mMasuCnt;r++)for(_=0;_<this.mSetting.mMasuCnt;_++)this.drawSingle(r,_,0,0,String(0));else if(t==LC_MSG_DRAW_INFO_ALL)for(r=0;r<this.mSetting.mMasuCnt;r++)for(_=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),i=this.mReversi.getMasuStsEna(this.mCurColor,r,_),n=this.mReversi.getMasuStsCnt(this.mCurColor,r,_),this.drawSingle(r,_,e,i,String(n));else if(t==LC_MSG_ERASE_INFO_ALL)for(var r=0;r<this.mSetting.mMasuCnt;r++)for(var _=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),this.drawSingle(r,_,e,0,String(0));else if(t==LC_MSG_DRAW_END)this.mPlayLock=0;else if(t==LC_MSG_CUR_COL){E="";E=this.mSetting.mMode==DEF_MODE_ONE?this.mCurColor==REVERSI_STS_BLACK?"あなたはプレイヤー1です ":this.mCurColor==REVERSI_STS_WHITE?"あなたはプレイヤー2です ":this.mCurColor==REVERSI_STS_BLUE?"あなたはプレイヤー3です ":"あなたはプレイヤー4です ":this.mCurColor==REVERSI_STS_BLACK?"プレイヤー1の番です ":this.mCurColor==REVERSI_STS_WHITE?"プレイヤー2の番です ":this.mCurColor==REVERSI_STS_BLUE?"プレイヤー3の番です ":"プレイヤー4の番です ",this.curColMsg(E)}else if(t==LC_MSG_CUR_COL_ERASE)this.curColMsg("");else if(t==LC_MSG_CUR_STS){var E="プレイヤー1 = "+this.mReversi.getBetCnt(REVERSI_STS_BLACK)+" プレイヤー2 = "+this.mReversi.getBetCnt(REVERSI_STS_WHITE)+" プレイヤー3 = "+this.mReversi.getBetCnt(REVERSI_STS_BLUE)+" プレイヤー4 = "+this.mReversi.getBetCnt(REVERSI_STS_RED);this.curStsMsg(E)}else t==LC_MSG_CUR_STS_ERASE&&this.curStsMsg("")},t.prototype.setSetting=function(t){this.mSetting=t},t.prototype.getetSetting=function(){return this.mSetting},t.prototype.getNextCol=function(t){return t==REVERSI_STS_BLACK?REVERSI_STS_WHITE:t==REVERSI_STS_WHITE?REVERSI_STS_BLUE:t==REVERSI_STS_BLUE?REVERSI_STS_RED:REVERSI_STS_BLACK},t}();