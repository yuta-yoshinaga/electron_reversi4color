var LC_MSG_DRAW=0,LC_MSG_ERASE=1,LC_MSG_DRAW_INFO=2,LC_MSG_ERASE_INFO=3,LC_MSG_DRAW_ALL=4,LC_MSG_ERASE_ALL=5,LC_MSG_DRAW_INFO_ALL=6,LC_MSG_ERASE_INFO_ALL=7,LC_MSG_DRAW_END=8,LC_MSG_CUR_COL=9,LC_MSG_CUR_COL_ERASE=10,LC_MSG_CUR_STS=11,LC_MSG_CUR_STS_ERASE=12,LC_MSG_MSG_DLG=13,LC_MSG_DRAW_ALL_RESET=14,ReversiPlay=function(){function t(){this.mCurColor=0,this.mPassEnaB=0,this.mPassEnaW=0,this.mPassEnaL=0,this.mPassEnaR=0,this.mGameEndSts=0,this.mPlayLock=0,this.viewMsgDlgFunc=null,this.drawSingleFunc=null,this.curColMsgFunc=null,this.curStsMsgFunc=null,this.mReversi=new Reversi(DEF_MASU_CNT_MAX_VAL,DEF_MASU_CNT_MAX_VAL),this.mSetting=new ReversiSetting,this.mCpu=new Array,this.mEdge=new Array;for(var t=0;t<DEF_MASU_CNT_MAX_VAL*DEF_MASU_CNT_MAX_VAL;t++)this.mCpu[t]=new ReversiPoint,this.mEdge[t]=new ReversiPoint;this.reset()}return t.prototype.reversiPlay=function(t,s){var e=0,i=0,n=this.mCurColor,S=0;if(1!=this.mPlayLock)if(this.mPlayLock=1,0==this.mReversi.getColorEna(this.mCurColor)?0==this.mReversi.setMasuSts(this.mCurColor,t,s)?(this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW,this.mPassEnaL,this.mPassEnaR),this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_ERASE_INFO_ALL,null),this.sendDrawMsg(t,s),this.drawUpdate(DEF_ASSIST_OFF),0==this.mReversi.getGameEndSts()?(n=this.getNextCol(n),0==this.mReversi.getColorEna(n)?this.mSetting.mMode==DEF_MODE_ONE?i=1:(this.mCurColor=n,this.drawUpdate(this.mSetting.mAssist)):(this.reversiPlayPass(n),S=1)):this.reversiPlayEnd(),e=1):this.viewMsgDlg("エラー","そのマスには置けません。"):0==this.mReversi.getGameEndSts()?(n=this.getNextCol(n),0==this.mReversi.getColorEna(n)?this.mSetting.mMode==DEF_MODE_ONE?(e=1,i=1):this.mCurColor=n:(this.reversiPlayPass(n),S=1)):this.reversiPlayEnd(),1==S&&this.mSetting.mMode==DEF_MODE_ONE&&this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_DRAW_INFO_ALL,null),1==e){var r=0;1==i&&(r=this.mSetting.mPlayCpuInterVal);var _=this;setTimeout(function(t,s){_.reversiPlaySub(t,s),_.mPlayLock=0},r,i,n)}else this.mPlayLock=0},t.prototype.reversiPlaySub=function(t,s){for(var e;;){if(e=this.reversiPlayCpu(s,t),t=0,1==e)if(0==this.mReversi.getGameEndSts())for(;;){if(s=this.getNextCol(s),0==this.mReversi.getColorEna(s)){s!=this.mCurColor&&(t=1);break}0!=this.mReversi.getBetCnt(s)&&this.reversiPlayPass(s)}else this.reversiPlayEnd();if(0==t)break}},t.prototype.reversiPlayEnd=function(){if(0==this.mGameEndSts){this.mGameEndSts=1;var t=this.gameEndAnimExec(),s=this;this.mPlayLock=1,setTimeout(function(){var t,e,i,n,S,r,_,E,m;n=s.mReversi.getBetCnt(REVERSI_STS_BLACK),S=s.mReversi.getBetCnt(REVERSI_STS_WHITE),r=s.mReversi.getBetCnt(REVERSI_STS_BLUE),_=s.mReversi.getBetCnt(REVERSI_STS_RED),m=Math.max(n,S,r,_),E=s.mCurColor==REVERSI_STS_BLACK?n:s.mCurColor==REVERSI_STS_WHITE?S:s.mCurColor==REVERSI_STS_BLUE?r:_,t="プレイヤー1 = "+String(n)+" プレイヤー2 = "+String(S)+" プレイヤー3 = "+String(r)+" プレイヤー4 = "+String(_),e=s.mSetting.mMode==DEF_MODE_ONE?m==n&&m==S&&m==r&&m==_?"引き分けです。":m==E?"あなたの勝ちです。":"あなたの負けです。":m==n&&m==S&&m==r&&m==_?"引き分けです。":m==n?"プレイヤー1の勝ちです。":m==S?"プレイヤー2の勝ちです。":m==r?"プレイヤー3の勝ちです。":"プレイヤー4の勝ちです。",i=t+e,s.viewMsgDlg("ゲーム終了",i),s.mSetting.mEndAnim==DEF_END_ANIM_ON&&(s.execMessage(LC_MSG_CUR_COL,null),s.execMessage(LC_MSG_CUR_STS,null))},t)}},t.prototype.reversiPlayPass=function(t){this.mSetting.mMode==DEF_MODE_ONE||(t==REVERSI_STS_BLACK?this.viewMsgDlg("","プレイヤー1はパスです。"):t==REVERSI_STS_WHITE?this.viewMsgDlg("","プレイヤー2はパスです。"):t==REVERSI_STS_BLUE?this.viewMsgDlg("","プレイヤー3はパスです。"):this.viewMsgDlg("","プレイヤー4はパスです。"))},t.prototype.reversiPlayCpu=function(t,s){for(var e,i,n=0;1==s;){s=0;var S=this.mReversi.getPointCnt(t),r=this.mReversi.getPoint(t,Math.floor(Math.random()*S));if(null!=r){if(e=r.y,i=r.x,this.mSetting.mType!=DEF_TYPE_EASY){var _,E,m,a,o,h,R,g,C,u,M,l,v,L,A,D,T,I;_=0,E=0,m=0,a=0,o=-1,h=-1,R=-1,g=-1,C=0,u=0,M=0,l=this.mSetting.mMasuCnt*this.mSetting.mMasuCnt,v=0,L=0,A=new Array(3),t==REVERSI_STS_BLACK?(A[0]=REVERSI_STS_WHITE,A[1]=REVERSI_STS_BLUE,A[2]=REVERSI_STS_RED):t==REVERSI_STS_WHITE?(A[0]=REVERSI_STS_BLACK,A[1]=REVERSI_STS_BLUE,A[2]=REVERSI_STS_RED):t==REVERSI_STS_BLUE?(A[0]=REVERSI_STS_BLACK,A[1]=REVERSI_STS_WHITE,A[2]=REVERSI_STS_RED):(A[0]=REVERSI_STS_BLACK,A[1]=REVERSI_STS_WHITE,A[2]=REVERSI_STS_BLUE),D=0;for(var c=0;3>c;c++)D+=this.mReversi.getBetCnt(A[c]);T=this.mReversi.getBetCnt(t),I=0,16>=l-(D+T)&&(I=1);for(var c=0;l>c;c++)this.mCpu[c].x=0,this.mCpu[c].y=0,this.mEdge[c].x=0,this.mEdge[c].y=0;for(var c=0;c<this.mSetting.mMasuCnt;c++)for(var d=0;d<this.mSetting.mMasuCnt;d++)0!=this.mReversi.getMasuStsEna(t,c,d)&&(0==this.mReversi.getEdgeSideOne(c,d)?(this.mEdge[M].x=d,this.mEdge[M].y=c,M++):(this.mCpu[C].x=d,this.mCpu[C].y=c,C++),this.mSetting.mType==DEF_TYPE_NOR&&(0==this.mReversi.getEdgeSideZero(c,d)&&(E=1,u=C-1),0==E&&0==this.mReversi.getEdgeSideTwo(c,d)&&(m=1,u=C-1),0==E&&0==m&&0==this.mReversi.getEdgeSideThree(c,d)&&(_=1,u=C-1)),this.mReversi.getMasuStsCnt(t,c,d)==D&&(e=c,i=d,v=1),0==v&&0!=this.mReversi.getPassEna(t,c,d)&&(e=c,i=d,L=1));if(0==v&&0==L){var P,y=-1,f=-1,p=-1,F=-1;if(0!=C){for(var c=0;C>c;c++)this.mSetting.mType==DEF_TYPE_HARD&&(P=this.mReversi.getPointAnz(t,this.mCpu[c].y,this.mCpu[c].x),null!=P&&(-1==y?(y=P.badPoint,f=P.goodPoint,p=P.pointCnt,F=P.ownPointCnt,h=c,R=c,g=c):(P.badPoint<y&&(y=P.badPoint,h=c),f<P.goodPoint&&(f=P.goodPoint,R=c),P.pointCnt<p?(p=P.pointCnt,F=P.ownPointCnt,g=c):P.pointCnt==p&&F<P.ownPointCnt&&(F=P.ownPointCnt,g=c)))),2==this.mReversi.getMasuStsEna(t,this.mCpu[c].y,this.mCpu[c].x)&&(o=c);-1!=h&&(0!=I?-1!=R&&(h=R):-1!=g&&(h=g),o=h),-1==o&&(o=Math.floor(Math.random()*C))}else if(0!=M){for(var c=0;M>c;c++)this.mSetting.mType==DEF_TYPE_HARD&&(P=this.mReversi.getPointAnz(t,this.mEdge[c].y,this.mEdge[c].x),null!=P&&(-1==y?(y=P.badPoint,f=P.goodPoint,p=P.pointCnt,F=P.ownPointCnt,h=c,R=c,g=c):(P.badPoint<y&&(y=P.badPoint,h=c),f<P.goodPoint&&(f=P.goodPoint,R=c),P.pointCnt<p?(p=P.pointCnt,F=P.ownPointCnt,g=c):P.pointCnt==p&&F<P.ownPointCnt&&(F=P.ownPointCnt,g=c)))),2==this.mReversi.getMasuStsEna(t,this.mEdge[c].y,this.mEdge[c].x)&&(o=c);-1!=h&&(0!=I?-1!=R&&(h=R):-1!=g&&(h=g),o=h),-1==o&&(o=Math.floor(Math.random()*M));for(var c=0;M>c;c++)0!=this.mReversi.checkEdge(t,this.mEdge[c].y,this.mEdge[c].x)&&0==_&&0==E&&0==m&&(a=1,u=c)}0==E&&0==m&&0==_&&0==a&&(u=o),0!=C?(e=this.mCpu[u].y,i=this.mCpu[u].x):0!=M&&(e=this.mEdge[u].y,i=this.mEdge[u].x)}}0==this.mReversi.setMasuSts(t,e,i)&&(this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW,this.mPassEnaL,this.mPassEnaR),this.sendDrawMsg(e,i),n=1)}}return 1==n&&(this.drawUpdate(DEF_ASSIST_OFF),this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_DRAW_INFO_ALL,null)),n},t.prototype.drawUpdate=function(t){if(t==DEF_ASSIST_ON)for(var s=0;s<this.mSetting.mMasuCnt;s++)for(var e=0;e<this.mSetting.mMasuCnt;e++)this.sendDrawInfoMsg(s,e);for(var i=this.mSetting.mPlayDrawInterVal,n=this,s=0;s<this.mSetting.mMasuCnt;s++)for(var e=0;e<this.mSetting.mMasuCnt;e++)this.mReversi.getMasuSts(s,e)!=this.mReversi.getMasuStsOld(s,e)&&(setTimeout(function(t,s){n.sendDrawMsg(t,s)},i,s,e),i+=this.mSetting.mPlayDrawInterVal);this.execMessage(LC_MSG_CUR_COL,null),this.execMessage(LC_MSG_CUR_STS,null)},t.prototype.drawUpdateForcibly=function(t){this.execMessage(LC_MSG_DRAW_ALL,null),t==DEF_ASSIST_ON?this.execMessage(LC_MSG_DRAW_INFO_ALL,null):this.execMessage(LC_MSG_ERASE_INFO_ALL,null),this.execMessage(LC_MSG_CUR_COL,null),this.execMessage(LC_MSG_CUR_STS,null)},t.prototype.reset=function(){if(this.mPassEnaB=0,this.mPassEnaW=0,this.mPassEnaL=0,this.mPassEnaR=0,this.mSetting.mGameSpd==DEF_GAME_SPD_FAST?(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_FAST_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_FAST_VAL2):this.mSetting.mGameSpd==DEF_GAME_SPD_MID?(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_MID_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_MID_VAL2):(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_SLOW_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_SLOW_VAL2),this.mCurColor=this.mSetting.mPlayer,this.mSetting.mMode==DEF_MODE_TWO&&(this.mCurColor=REVERSI_STS_BLACK),this.mReversi.setMasuCnt(this.mSetting.mMasuCnt),this.mReversi.reset(),this.mSetting.mMode==DEF_MODE_ONE&&this.mCurColor!=REVERSI_STS_BLACK){var t,s,e,i;for(t=REVERSI_STS_BLACK;s=this.mReversi.getPointCnt(t),i=0!=s?this.mReversi.getPoint(t,Math.floor(Math.random()*s)):null,null!=i&&(this.mReversi.setMasuSts(t,i.y,i.x),this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW,this.mPassEnaL,this.mPassEnaR)),e=this.getNextCol(t),e!=this.mCurColor;)t=e}this.mPlayLock=1,this.mGameEndSts=0,this.drawUpdateForcibly(this.mSetting.mAssist),this.execMessage(LC_MSG_DRAW_END,null)},t.prototype.gameEndAnimExec=function(){var t,s,e,i,n=2,S=0;if(this.mSetting.mEndAnim==DEF_END_ANIM_ON){t=this.mReversi.getBetCnt(REVERSI_STS_BLACK),s=this.mReversi.getBetCnt(REVERSI_STS_WHITE),e=this.mReversi.getBetCnt(REVERSI_STS_BLUE),i=this.mReversi.getBetCnt(REVERSI_STS_RED),this.execMessage(LC_MSG_CUR_COL_ERASE,null),this.execMessage(LC_MSG_CUR_STS_ERASE,null);var r=this;setTimeout(function(t,s){for(var n=0;n<r.mSetting.mMasuCnt;n++)for(var S=0;S<r.mSetting.mMasuCnt;S++)r.mReversi.setMasuStsForcibly(REVERSI_STS_NONE,n,S);r.execMessage(LC_MSG_ERASE_ALL,null);var _,E,m,a,o,h,R,g;_=0,E=0,m=0,a=0,o=0,h=0,R=0,g=0;for(var C=r.mSetting.mEndDrawInterVal,n=0;n<r.mSetting.mMasuCnt;n++)for(var S=0;S<r.mSetting.mMasuCnt&&(t>_?(_++,setTimeout(function(t,s){r.mReversi.setMasuStsForcibly(REVERSI_STS_BLACK,t,s),r.sendDrawMsg(t,s)},C,n,S)):o=1,s>E?(E++,setTimeout(function(t,s){r.mReversi.setMasuStsForcibly(REVERSI_STS_WHITE,r.mSetting.mMasuCnt-1-t,r.mSetting.mMasuCnt-1-s),r.sendDrawMsg(r.mSetting.mMasuCnt-1-t,r.mSetting.mMasuCnt-1-s)},C,n,S)):h=1,1==o&&(e>m?(m++,setTimeout(function(t,s){r.mReversi.setMasuStsForcibly(REVERSI_STS_BLUE,t,s),r.sendDrawMsg(t,s)},C,n,S)):R=1),1==h&&(i>a?(a++,setTimeout(function(t,s){r.mReversi.setMasuStsForcibly(REVERSI_STS_RED,r.mSetting.mMasuCnt-1-t,r.mSetting.mMasuCnt-1-s),r.sendDrawMsg(r.mSetting.mMasuCnt-1-t,r.mSetting.mMasuCnt-1-s)},C,n,S)):g=1),1!=o||1!=h||1!=R||1!=g);S++)C+=r.mSetting.mEndDrawInterVal},this.mSetting.mEndInterVal,t,s),S=this.mSetting.mEndInterVal+this.mSetting.mEndDrawInterVal*(Math.max(t,s)+Math.max(e,i)+n)}return S},t.prototype.sendDrawMsg=function(t,s){var e=new ReversiPoint;e.y=t,e.x=s,this.execMessage(LC_MSG_DRAW,e)},t.prototype.sendDrawInfoMsg=function(t,s){var e=new ReversiPoint;e.y=t,e.x=s,this.execMessage(LC_MSG_DRAW_INFO,e)},t.prototype.setViewMsgDlgFunc=function(t){this.viewMsgDlgFunc=t},t.prototype.viewMsgDlg=function(t,s){null!=this.viewMsgDlgFunc&&this.viewMsgDlgFunc(t,s)},t.prototype.setDrawSingleFunc=function(t){this.drawSingleFunc=t},t.prototype.drawSingle=function(t,s,e,i,n){null!=this.drawSingleFunc&&("0"==n&&(n=""),this.drawSingleFunc(t,s,e,i,n))},t.prototype.setCurColMsgFunc=function(t){this.curColMsgFunc=t},t.prototype.curColMsg=function(t){null!=this.curColMsgFunc&&this.curColMsgFunc(t)},t.prototype.setCurStsMsgFunc=function(t){this.curStsMsgFunc=t},t.prototype.curStsMsg=function(t){null!=this.curStsMsgFunc&&this.curStsMsgFunc(t)},t.prototype.execMessage=function(t,s){var e,i,n;if(t==LC_MSG_DRAW){var S=s;e=this.mReversi.getMasuSts(S.y,S.x),i=this.mReversi.getMasuStsEna(this.mCurColor,S.y,S.x),n=this.mReversi.getMasuStsCnt(this.mCurColor,S.y,S.x),this.drawSingle(S.y,S.x,e,i,String(n))}else if(t==LC_MSG_ERASE){var S=s;this.drawSingle(S.y,S.x,0,0,String(0))}else if(t==LC_MSG_DRAW_INFO){var S=s;e=this.mReversi.getMasuSts(S.y,S.x),i=this.mReversi.getMasuStsEna(this.mCurColor,S.y,S.x),n=this.mReversi.getMasuStsCnt(this.mCurColor,S.y,S.x),this.drawSingle(S.y,S.x,e,i,String(n))}else if(t==LC_MSG_ERASE_INFO){var S=s;e=this.mReversi.getMasuSts(S.y,S.x),this.drawSingle(S.y,S.x,e,0,String(0))}else if(t==LC_MSG_DRAW_ALL)for(var r=0;r<this.mSetting.mMasuCnt;r++)for(var _=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),i=this.mReversi.getMasuStsEna(this.mCurColor,r,_),n=this.mReversi.getMasuStsCnt(this.mCurColor,r,_),this.drawSingle(r,_,e,i,String(n));else if(t==LC_MSG_ERASE_ALL)for(var r=0;r<this.mSetting.mMasuCnt;r++)for(var _=0;_<this.mSetting.mMasuCnt;_++)this.drawSingle(r,_,0,0,String(0));else if(t==LC_MSG_DRAW_INFO_ALL)for(var r=0;r<this.mSetting.mMasuCnt;r++)for(var _=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),i=this.mReversi.getMasuStsEna(this.mCurColor,r,_),n=this.mReversi.getMasuStsCnt(this.mCurColor,r,_),this.drawSingle(r,_,e,i,String(n));else if(t==LC_MSG_ERASE_INFO_ALL)for(var r=0;r<this.mSetting.mMasuCnt;r++)for(var _=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),this.drawSingle(r,_,e,0,String(0));else if(t==LC_MSG_DRAW_END)this.mPlayLock=0;else if(t==LC_MSG_CUR_COL){var E="";E=this.mSetting.mMode==DEF_MODE_ONE?this.mCurColor==REVERSI_STS_BLACK?"あなたはプレイヤー1です ":this.mCurColor==REVERSI_STS_WHITE?"あなたはプレイヤー2です ":this.mCurColor==REVERSI_STS_BLUE?"あなたはプレイヤー3です ":"あなたはプレイヤー4です ":this.mCurColor==REVERSI_STS_BLACK?"プレイヤー1の番です ":this.mCurColor==REVERSI_STS_WHITE?"プレイヤー2の番です ":this.mCurColor==REVERSI_STS_BLUE?"プレイヤー3の番です ":"プレイヤー4の番です ",this.curColMsg(E)}else if(t==LC_MSG_CUR_COL_ERASE)this.curColMsg("");else if(t==LC_MSG_CUR_STS){var E="プレイヤー1 = "+this.mReversi.getBetCnt(REVERSI_STS_BLACK)+" プレイヤー2 = "+this.mReversi.getBetCnt(REVERSI_STS_WHITE)+" プレイヤー3 = "+this.mReversi.getBetCnt(REVERSI_STS_BLUE)+" プレイヤー4 = "+this.mReversi.getBetCnt(REVERSI_STS_RED);this.curStsMsg(E)}else t==LC_MSG_CUR_STS_ERASE&&this.curStsMsg("")},t.prototype.setSetting=function(t){this.mSetting=t},t.prototype.getetSetting=function(){return this.mSetting},t.prototype.getNextCol=function(t){var s=t;return s=t==REVERSI_STS_BLACK?REVERSI_STS_WHITE:t==REVERSI_STS_WHITE?REVERSI_STS_BLUE:t==REVERSI_STS_BLUE?REVERSI_STS_RED:REVERSI_STS_BLACK},t}();