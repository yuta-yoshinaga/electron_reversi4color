var LC_MSG_DRAW=0,LC_MSG_ERASE=1,LC_MSG_DRAW_INFO=2,LC_MSG_ERASE_INFO=3,LC_MSG_DRAW_ALL=4,LC_MSG_ERASE_ALL=5,LC_MSG_DRAW_INFO_ALL=6,LC_MSG_ERASE_INFO_ALL=7,LC_MSG_DRAW_END=8,LC_MSG_CUR_COL=9,LC_MSG_CUR_COL_ERASE=10,LC_MSG_CUR_STS=11,LC_MSG_CUR_STS_ERASE=12,LC_MSG_MSG_DLG=13,LC_MSG_DRAW_ALL_RESET=14,ReversiPlay=function(){function t(){this.mCurColor=0,this.mPassEnaB=0,this.mPassEnaW=0,this.mPassEnaL=0,this.mPassEnaR=0,this.mGameEndSts=0,this.mPlayLock=0,this.viewMsgDlgFunc=null,this.drawSingleFunc=null,this.curColMsgFunc=null,this.curStsMsgFunc=null,this.mReversi=new Reversi(DEF_MASU_CNT_MAX_VAL,DEF_MASU_CNT_MAX_VAL),this.mSetting=new ReversiSetting,this.mCpu=new Array,this.mEdge=new Array;for(var t=0;t<DEF_MASU_CNT_MAX_VAL*DEF_MASU_CNT_MAX_VAL;t++)this.mCpu[t]=new ReversiPoint,this.mEdge[t]=new ReversiPoint;this.reset()}return t.prototype.reversiPlay=function(t,s){var e=0,i=0,n=this.mCurColor,S=0;if(1!=this.mPlayLock){if(this.mPlayLock=1,0==this.mReversi.getColorEna(this.mCurColor))if(0==this.mReversi.setMasuSts(this.mCurColor,t,s)){if(this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW,this.mPassEnaL,this.mPassEnaR),this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_ERASE_INFO_ALL,null),this.sendDrawMsg(t,s),this.drawUpdate(DEF_ASSIST_OFF),0==this.mReversi.getGameEndSts())for(;;){if(n=this.getNextCol(n),0==this.mReversi.getColorEna(n)){this.mSetting.mMode==DEF_MODE_ONE?i=1:(this.mCurColor=n,this.drawUpdate(this.mSetting.mAssist));break}this.reversiPlayPass(n),S=1}else this.reversiPlayEnd();e=1}else this.viewMsgDlg("エラー","そのマスには置けません。");else if(0==this.mReversi.getGameEndSts())for(;;){if(n=this.getNextCol(n),0==this.mReversi.getColorEna(n)){this.mSetting.mMode==DEF_MODE_ONE?n!=this.mCurColor&&(i=1):(this.mCurColor=n,this.drawUpdate(this.mSetting.mAssist));break}0!=this.mReversi.getBetCnt(n)&&this.reversiPlayPass(n),S=1}else this.reversiPlayEnd();if(1==S&&0==i&&this.mSetting.mMode==DEF_MODE_ONE&&this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_DRAW_INFO_ALL,null),1==e){var r=0;1==i&&(r=this.mSetting.mPlayCpuInterVal);var _=this;setTimeout(function(t,s){_.reversiPlaySub(t,s),_.mPlayLock=0},r,i,n)}else this.mPlayLock=0}},t.prototype.reversiPlaySub=function(t,s){for(var e;;){if(e=this.reversiPlayCpu(s,t),t=0,1==e)if(0==this.mReversi.getGameEndSts())for(;;){if(s=this.getNextCol(s),0==this.mReversi.getColorEna(s)){s!=this.mCurColor&&(t=1);break}0!=this.mReversi.getBetCnt(s)&&this.reversiPlayPass(s)}else this.reversiPlayEnd();if(0==t)break}},t.prototype.reversiPlayEnd=function(){if(0==this.mGameEndSts){this.mGameEndSts=1;var t=this.gameEndAnimExec(),s=this;this.mPlayLock=1,setTimeout(function(){var t,e,i,n,S,r,_;e=s.mReversi.getBetCnt(REVERSI_STS_BLACK),i=s.mReversi.getBetCnt(REVERSI_STS_WHITE),n=s.mReversi.getBetCnt(REVERSI_STS_BLUE),S=s.mReversi.getBetCnt(REVERSI_STS_RED),_=Math.max(e,i,n,S),r=s.mCurColor==REVERSI_STS_BLACK?e:s.mCurColor==REVERSI_STS_WHITE?i:s.mCurColor==REVERSI_STS_BLUE?n:S,t="プレイヤー1 = "+String(e)+" プレイヤー2 = "+String(i)+" プレイヤー3 = "+String(n)+" プレイヤー4 = "+String(S)+(s.mSetting.mMode==DEF_MODE_ONE?_==e&&_==i&&_==n&&_==S?"引き分けです。":_==r?"あなたの勝ちです。":"あなたの負けです。":_==e&&_==i&&_==n&&_==S?"引き分けです。":_==e?"プレイヤー1の勝ちです。":_==i?"プレイヤー2の勝ちです。":_==n?"プレイヤー3の勝ちです。":"プレイヤー4の勝ちです。"),s.viewMsgDlg("ゲーム終了",t),s.mSetting.mEndAnim==DEF_END_ANIM_ON&&(s.execMessage(LC_MSG_CUR_COL,null),s.execMessage(LC_MSG_CUR_STS,null))},t)}},t.prototype.reversiPlayPass=function(t){this.mSetting.mMode==DEF_MODE_ONE||(t==REVERSI_STS_BLACK?this.viewMsgDlg("","プレイヤー1はパスです。"):t==REVERSI_STS_WHITE?this.viewMsgDlg("","プレイヤー2はパスです。"):t==REVERSI_STS_BLUE?this.viewMsgDlg("","プレイヤー3はパスです。"):this.viewMsgDlg("","プレイヤー4はパスです。"))},t.prototype.reversiPlayCpu=function(t,s){for(var e,i,n=0;1==s;){s=0;var S=this.mReversi.getPointCnt(t),r=this.mReversi.getPoint(t,Math.floor(Math.random()*S));if(null!=r){if(e=r.y,i=r.x,this.mSetting.mType!=DEF_TYPE_EASY){var _,m,E,a,o,h,R,g,C,u,l,M,L,v,A,D,T;_=0,m=0,E=0,a=0,o=-1,h=-1,R=-1,g=-1,C=0,u=0,l=0,M=this.mSetting.mMasuCnt*this.mSetting.mMasuCnt,L=0,v=0,A=new Array(3),t==REVERSI_STS_BLACK?(A[0]=REVERSI_STS_WHITE,A[1]=REVERSI_STS_BLUE,A[2]=REVERSI_STS_RED):t==REVERSI_STS_WHITE?(A[0]=REVERSI_STS_BLACK,A[1]=REVERSI_STS_BLUE,A[2]=REVERSI_STS_RED):t==REVERSI_STS_BLUE?(A[0]=REVERSI_STS_BLACK,A[1]=REVERSI_STS_WHITE,A[2]=REVERSI_STS_RED):(A[0]=REVERSI_STS_BLACK,A[1]=REVERSI_STS_WHITE,A[2]=REVERSI_STS_BLUE),D=0;for(var I=0;I<3;I++)D+=this.mReversi.getBetCnt(A[I]);T=0,M-(D+this.mReversi.getBetCnt(t))<=16&&(T=1);for(I=0;I<M;I++)this.mCpu[I].x=0,this.mCpu[I].y=0,this.mEdge[I].x=0,this.mEdge[I].y=0;for(I=0;I<this.mSetting.mMasuCnt;I++)for(var d=0;d<this.mSetting.mMasuCnt;d++)0!=this.mReversi.getMasuStsEna(t,I,d)&&(0==this.mReversi.getEdgeSideOne(I,d)?(this.mEdge[l].x=d,this.mEdge[l].y=I,l++):(this.mCpu[C].x=d,this.mCpu[C].y=I,C++),this.mSetting.mType==DEF_TYPE_NOR&&(0==this.mReversi.getEdgeSideZero(I,d)&&(m=1,u=C-1),0==m&&0==this.mReversi.getEdgeSideTwo(I,d)&&(E=1,u=C-1),0==m&&0==E&&0==this.mReversi.getEdgeSideThree(I,d)&&(_=1,u=C-1)),this.mReversi.getMasuStsCnt(t,I,d)==D&&(e=I,i=d,L=1),0==L&&0!=this.mReversi.getPassEna(t,I,d)&&(e=I,i=d,v=1));if(0==L&&0==v){var c,f=-1,P=-1,y=-1,p=-1;if(0!=C){for(I=0;I<C;I++)this.mSetting.mType==DEF_TYPE_HARD&&null!=(c=this.mReversi.getPointAnz(t,this.mCpu[I].y,this.mCpu[I].x))&&(-1==f?(f=c.badPoint,P=c.goodPoint,y=c.pointCnt,p=c.ownPointCnt,h=I,R=I,g=I):(c.badPoint<f&&(f=c.badPoint,h=I),P<c.goodPoint&&(P=c.goodPoint,R=I),c.pointCnt<y?(y=c.pointCnt,p=c.ownPointCnt,g=I):c.pointCnt==y&&p<c.ownPointCnt&&(p=c.ownPointCnt,g=I))),2==this.mReversi.getMasuStsEna(t,this.mCpu[I].y,this.mCpu[I].x)&&(o=I);-1!=h&&(0!=T?-1!=R&&(h=R):-1!=g&&(h=g),o=h),-1==o&&(o=Math.floor(Math.random()*C))}else if(0!=l){for(I=0;I<l;I++)this.mSetting.mType==DEF_TYPE_HARD&&null!=(c=this.mReversi.getPointAnz(t,this.mEdge[I].y,this.mEdge[I].x))&&(-1==f?(f=c.badPoint,P=c.goodPoint,y=c.pointCnt,p=c.ownPointCnt,h=I,R=I,g=I):(c.badPoint<f&&(f=c.badPoint,h=I),P<c.goodPoint&&(P=c.goodPoint,R=I),c.pointCnt<y?(y=c.pointCnt,p=c.ownPointCnt,g=I):c.pointCnt==y&&p<c.ownPointCnt&&(p=c.ownPointCnt,g=I))),2==this.mReversi.getMasuStsEna(t,this.mEdge[I].y,this.mEdge[I].x)&&(o=I);-1!=h&&(0!=T?-1!=R&&(h=R):-1!=g&&(h=g),o=h),-1==o&&(o=Math.floor(Math.random()*l));for(I=0;I<l;I++)0!=this.mReversi.checkEdge(t,this.mEdge[I].y,this.mEdge[I].x)&&0==_&&0==m&&0==E&&(a=1,u=I)}0==m&&0==E&&0==_&&0==a&&(u=o),0!=C?(e=this.mCpu[u].y,i=this.mCpu[u].x):0!=l&&(e=this.mEdge[u].y,i=this.mEdge[u].x)}}0==this.mReversi.setMasuSts(t,e,i)&&(this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW,this.mPassEnaL,this.mPassEnaR),this.sendDrawMsg(e,i),n=1)}}return 1==n&&(this.drawUpdate(DEF_ASSIST_OFF),this.mSetting.mAssist==DEF_ASSIST_ON&&this.execMessage(LC_MSG_DRAW_INFO_ALL,null)),n},t.prototype.drawUpdate=function(t){if(t==DEF_ASSIST_ON)for(var s=0;s<this.mSetting.mMasuCnt;s++)for(var e=0;e<this.mSetting.mMasuCnt;e++)this.sendDrawInfoMsg(s,e);var i=this.mSetting.mPlayDrawInterVal,n=this;for(s=0;s<this.mSetting.mMasuCnt;s++)for(e=0;e<this.mSetting.mMasuCnt;e++)this.mReversi.getMasuSts(s,e)!=this.mReversi.getMasuStsOld(s,e)&&(setTimeout(function(t,s){n.sendDrawMsg(t,s)},i,s,e),i+=this.mSetting.mPlayDrawInterVal);this.execMessage(LC_MSG_CUR_COL,null),this.execMessage(LC_MSG_CUR_STS,null)},t.prototype.drawUpdateForcibly=function(t){this.execMessage(LC_MSG_DRAW_ALL,null),t==DEF_ASSIST_ON?this.execMessage(LC_MSG_DRAW_INFO_ALL,null):this.execMessage(LC_MSG_ERASE_INFO_ALL,null),this.execMessage(LC_MSG_CUR_COL,null),this.execMessage(LC_MSG_CUR_STS,null)},t.prototype.reset=function(){var t,s,e,i;if((this.mPassEnaB=0,this.mPassEnaW=0,this.mPassEnaL=0,this.mPassEnaR=0,this.mSetting.mGameSpd==DEF_GAME_SPD_FAST?(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_FAST_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_FAST_VAL2):this.mSetting.mGameSpd==DEF_GAME_SPD_MID?(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_MID_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_MID_VAL2):(this.mSetting.mPlayDrawInterVal=DEF_GAME_SPD_SLOW_VAL,this.mSetting.mPlayCpuInterVal=DEF_GAME_SPD_SLOW_VAL2),this.mCurColor=this.mSetting.mPlayer,this.mSetting.mMode==DEF_MODE_TWO&&(this.mCurColor=REVERSI_STS_BLACK),this.mReversi.setMasuCnt(this.mSetting.mMasuCnt),this.mReversi.reset(),this.mSetting.mMode==DEF_MODE_ONE)&&this.mCurColor!=REVERSI_STS_BLACK)for(t=REVERSI_STS_BLACK;null!=(i=0!=(s=this.mReversi.getPointCnt(t))?this.mReversi.getPoint(t,Math.floor(Math.random()*s)):null)&&(this.mReversi.setMasuSts(t,i.y,i.x),this.mSetting.mType==DEF_TYPE_HARD&&this.mReversi.AnalysisReversi(this.mPassEnaB,this.mPassEnaW,this.mPassEnaL,this.mPassEnaR)),(e=this.getNextCol(t))!=this.mCurColor;)t=e;this.mPlayLock=1,this.mGameEndSts=0,this.drawUpdateForcibly(this.mSetting.mAssist),this.execMessage(LC_MSG_DRAW_END,null)},t.prototype.gameEndAnimExec=function(){var t,s,e,i,n=0;if(this.mSetting.mEndAnim==DEF_END_ANIM_ON){t=this.mReversi.getBetCnt(REVERSI_STS_BLACK),s=this.mReversi.getBetCnt(REVERSI_STS_WHITE),e=this.mReversi.getBetCnt(REVERSI_STS_BLUE),i=this.mReversi.getBetCnt(REVERSI_STS_RED),this.execMessage(LC_MSG_CUR_COL_ERASE,null),this.execMessage(LC_MSG_CUR_STS_ERASE,null);var S=this;setTimeout(function(t,s){for(var n=0;n<S.mSetting.mMasuCnt;n++)for(var r=0;r<S.mSetting.mMasuCnt;r++)S.mReversi.setMasuStsForcibly(REVERSI_STS_NONE,n,r);var _,m,E,a,o,h,R,g;S.execMessage(LC_MSG_ERASE_ALL,null),_=0,m=0,E=0,a=0,o=0,h=0,R=0,g=0;var C=S.mSetting.mEndDrawInterVal;for(n=0;n<S.mSetting.mMasuCnt;n++)for(r=0;r<S.mSetting.mMasuCnt&&(_<t?(_++,setTimeout(function(t,s){S.mReversi.setMasuStsForcibly(REVERSI_STS_BLACK,t,s),S.sendDrawMsg(t,s)},C,n,r)):o=1,m<s?(m++,setTimeout(function(t,s){S.mReversi.setMasuStsForcibly(REVERSI_STS_WHITE,S.mSetting.mMasuCnt-1-t,S.mSetting.mMasuCnt-1-s),S.sendDrawMsg(S.mSetting.mMasuCnt-1-t,S.mSetting.mMasuCnt-1-s)},C,n,r)):h=1,1==o&&(E<e?(E++,setTimeout(function(t,s){S.mReversi.setMasuStsForcibly(REVERSI_STS_BLUE,t,s),S.sendDrawMsg(t,s)},C,n,r)):R=1),1==h&&(a<i?(a++,setTimeout(function(t,s){S.mReversi.setMasuStsForcibly(REVERSI_STS_RED,S.mSetting.mMasuCnt-1-t,S.mSetting.mMasuCnt-1-s),S.sendDrawMsg(S.mSetting.mMasuCnt-1-t,S.mSetting.mMasuCnt-1-s)},C,n,r)):g=1),1!=o||1!=h||1!=R||1!=g);r++)C+=S.mSetting.mEndDrawInterVal},this.mSetting.mEndInterVal,t,s),n=this.mSetting.mEndInterVal+this.mSetting.mEndDrawInterVal*(Math.max(t,s)+Math.max(e,i)+2)}return n},t.prototype.sendDrawMsg=function(t,s){var e=new ReversiPoint;e.y=t,e.x=s,this.execMessage(LC_MSG_DRAW,e)},t.prototype.sendDrawInfoMsg=function(t,s){var e=new ReversiPoint;e.y=t,e.x=s,this.execMessage(LC_MSG_DRAW_INFO,e)},t.prototype.setViewMsgDlgFunc=function(t){this.viewMsgDlgFunc=t},t.prototype.viewMsgDlg=function(t,s){null!=this.viewMsgDlgFunc&&this.viewMsgDlgFunc(t,s)},t.prototype.setDrawSingleFunc=function(t){this.drawSingleFunc=t},t.prototype.drawSingle=function(t,s,e,i,n){null!=this.drawSingleFunc&&("0"==n&&(n=""),this.drawSingleFunc(t,s,e,i,n))},t.prototype.setCurColMsgFunc=function(t){this.curColMsgFunc=t},t.prototype.curColMsg=function(t){null!=this.curColMsgFunc&&this.curColMsgFunc(t)},t.prototype.setCurStsMsgFunc=function(t){this.curStsMsgFunc=t},t.prototype.curStsMsg=function(t){null!=this.curStsMsgFunc&&this.curStsMsgFunc(t)},t.prototype.execMessage=function(t,s){var e,i,n;if(t==LC_MSG_DRAW){var S=s;e=this.mReversi.getMasuSts(S.y,S.x),i=this.mReversi.getMasuStsEna(this.mCurColor,S.y,S.x),n=this.mReversi.getMasuStsCnt(this.mCurColor,S.y,S.x),this.drawSingle(S.y,S.x,e,i,String(n))}else if(t==LC_MSG_ERASE){S=s;this.drawSingle(S.y,S.x,0,0,String(0))}else if(t==LC_MSG_DRAW_INFO){S=s;e=this.mReversi.getMasuSts(S.y,S.x),i=this.mReversi.getMasuStsEna(this.mCurColor,S.y,S.x),n=this.mReversi.getMasuStsCnt(this.mCurColor,S.y,S.x),this.drawSingle(S.y,S.x,e,i,String(n))}else if(t==LC_MSG_ERASE_INFO){S=s;e=this.mReversi.getMasuSts(S.y,S.x),this.drawSingle(S.y,S.x,e,0,String(0))}else if(t==LC_MSG_DRAW_ALL)for(var r=0;r<this.mSetting.mMasuCnt;r++)for(var _=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),i=this.mReversi.getMasuStsEna(this.mCurColor,r,_),n=this.mReversi.getMasuStsCnt(this.mCurColor,r,_),this.drawSingle(r,_,e,i,String(n));else if(t==LC_MSG_ERASE_ALL)for(r=0;r<this.mSetting.mMasuCnt;r++)for(_=0;_<this.mSetting.mMasuCnt;_++)this.drawSingle(r,_,0,0,String(0));else if(t==LC_MSG_DRAW_INFO_ALL)for(r=0;r<this.mSetting.mMasuCnt;r++)for(_=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),i=this.mReversi.getMasuStsEna(this.mCurColor,r,_),n=this.mReversi.getMasuStsCnt(this.mCurColor,r,_),this.drawSingle(r,_,e,i,String(n));else if(t==LC_MSG_ERASE_INFO_ALL)for(r=0;r<this.mSetting.mMasuCnt;r++)for(_=0;_<this.mSetting.mMasuCnt;_++)e=this.mReversi.getMasuSts(r,_),this.drawSingle(r,_,e,0,String(0));else if(t==LC_MSG_DRAW_END)this.mPlayLock=0;else if(t==LC_MSG_CUR_COL){var m="";m=this.mSetting.mMode==DEF_MODE_ONE?this.mCurColor==REVERSI_STS_BLACK?"あなたはプレイヤー1です ":this.mCurColor==REVERSI_STS_WHITE?"あなたはプレイヤー2です ":this.mCurColor==REVERSI_STS_BLUE?"あなたはプレイヤー3です ":"あなたはプレイヤー4です ":this.mCurColor==REVERSI_STS_BLACK?"プレイヤー1の番です ":this.mCurColor==REVERSI_STS_WHITE?"プレイヤー2の番です ":this.mCurColor==REVERSI_STS_BLUE?"プレイヤー3の番です ":"プレイヤー4の番です ",this.curColMsg(m)}else if(t==LC_MSG_CUR_COL_ERASE)this.curColMsg("");else if(t==LC_MSG_CUR_STS){m="プレイヤー1 = "+this.mReversi.getBetCnt(REVERSI_STS_BLACK)+" プレイヤー2 = "+this.mReversi.getBetCnt(REVERSI_STS_WHITE)+" プレイヤー3 = "+this.mReversi.getBetCnt(REVERSI_STS_BLUE)+" プレイヤー4 = "+this.mReversi.getBetCnt(REVERSI_STS_RED);this.curStsMsg(m)}else t==LC_MSG_CUR_STS_ERASE&&this.curStsMsg("")},t.prototype.setSetting=function(t){this.mSetting=t},t.prototype.getetSetting=function(){return this.mSetting},t.prototype.getNextCol=function(t){return t==REVERSI_STS_BLACK?REVERSI_STS_WHITE:t==REVERSI_STS_WHITE?REVERSI_STS_BLUE:t==REVERSI_STS_BLUE?REVERSI_STS_RED:REVERSI_STS_BLACK},t}();